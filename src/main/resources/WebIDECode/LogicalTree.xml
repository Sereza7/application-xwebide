<?xml version="1.0" encoding="UTF-8"?>

<!--
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
-->

<xwikidoc reference="WebIDECode.LogicalTree" locale="">
  <web>WebIDECode</web>
  <name>LogicalTree</name>
  <language/>
  <defaultLanguage/>
  <translation>0</translation>
  <parent>Test.Test2</parent>
  <creator>xwiki:XWiki.Admin</creator>
  <author>xwiki:XWiki.Admin</author>
  <customClass/>
  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>
  <creationDate>1445347285000</creationDate>
  <date>1446459179000</date>
  <contentUpdateDate>1446459179000</contentUpdateDate>
  <version>1.1</version>
  <title>LogicalTree</title>
  <defaultTemplate/>
  <validationScript/>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.1</syntaxId>
  <hidden>false</hidden>
  <content>{{velocity}}
#set($codeSpace = "${doc.space}Code")
#if($masterDoc.codeSpace)
  #set($codeSpace = $masterDoc.codeSpace)
#end
#set($allPagesList = [])
#set($allJSList = [])
#set($allCSSList = [])
#set($allMacrosList = [])
#set($allTranslationsList = [])
## Get a list of all the pages in the project
#set($spacesList = $sorttool.sort($spacesList))
#foreach($space in $spacesList)
  #set($spaceInListNested = $spacesListNested.contains($space))
  #if($spaceInListNested)
    #set($xwql = "select distinct doc.name, doc.space from Document doc where doc.space=:space order by doc.name asc")
    #set($spacePageList = $services.query.xwql($xwql).bindValue('space', $space).execute())
    #foreach($element in $spacePageList)
      #set($localeList = $xwiki.getDocument("$element[1].$element[0]").getTranslationList())
      #set($localeList = $sorttool.sort($localeList))
      #if($localeList.size() &gt; 0)
        #set($ok = $localeList.add(0, $xwiki.getDocument("$element[1].$element[0]").defaultLanguage))
      #end
      #if(!$allPagesList.contains(["$element[1].$element[0]", $localeList]))
        #set($ok = $allPagesList.add(["$element[1].$element[0]", $localeList]))
      #end
    #end
    #if($spacePageList.size() == 0)
      #set($ok = $allPagesList.add(["$space.$reservedDocumentName", []]))
    #end
  #else
    #set($spacePageList = [])
    #foreach($page in $pagesList)
      #set($document = $xwiki.getDocument($page))
      #set($localeList = $document.getTranslationList())
      #set($localeList = $sorttool.sort($localeList))
      #if($localeList.size() &gt; 0)
        #set($ok = $localeList.add(0, $document.defaultLanguage))
      #end
      #if($space == $document.space &amp;&amp; !$allPagesList.contains([$document.fullName, $localeList]))
        #set($ok = $allPagesList.add([$document.fullName, $localeList]))
      #end
    #end
  #end
#end
(% class="btn btn-success" id="hierarchyAddNewElement" %)((($services.icon.render('add', 'Font Awesome') Add new...)))
(% class="btn btn-primary" id="hierarchyChangeTree" %)(((Physical view)))
  (% class="hierarchy-hidden" id="hierarchyElementToAdd"%)(((
    ==== Class ====
    [[Add new class&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||class="newPage newClass" data-space='$escapetool.url($codeSpace).replace('+', '%20')' data-toggle="modal" data-target="#hierarchyPageModal"]]
    ==== Pages ====
    [[Add/create a space&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||class="newFolder" data-toggle="modal" data-target="#hierarchyFolderModal"]]
    [[Add an existing page&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||class="newExistingPage" data-toggle="modal" data-target="#hierarchyExistingPageModal"]]
    [[Create a new page&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||class="newPage" data-toggle="modal" data-target="#hierarchyPageModal"]]
    ==== Global ====
    [[Add JavaScript&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||class="newJSObject newGlobalObject" data-space='$escapetool.url($codeSpace).replace('+', '%20')' data-page='' data-toggle="modal" data-target="#hierarchyObjectModal"]]
    [[Add CSS&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||class="newCSSObject newGlobalObject" data-space='$escapetool.url($codeSpace).replace('+', '%20')' data-page='' data-toggle="modal" data-target="#hierarchyObjectModal"]]
    [[Add Macros&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||class="newMacroObject newGlobalObject" data-space='$escapetool.url($codeSpace).replace('+', '%20')' data-page='' data-toggle="modal" data-target="#hierarchyObjectModal"]]
    [[Add Translation&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||class="newTranslationObject newGlobalObject" data-space='$escapetool.url($codeSpace).replace('+', '%20')' data-page='Translations' data-toggle="modal" data-target="#hierarchyObjectModal"]]
  )))
## Display all the classes in the project
(% class="hierarchy-list hierarchy-no-padding" id="hierarchyMainList" %)
#set($pageClassHidden = " hierarchy-hidden")
#set($iconBulletToggle = "(% class='hierarchyDisplayPageIcon'%)$services.icon.render('caret-right', 'Font Awesome')")
#if($visibleCategory.contains("classes"))
  #set($pageClassHidden = "")
  #set($iconBulletToggle = "(% class='hierarchyDisplayPageIcon'%)$services.icon.render('caret-down', 'Font Awesome')")
#end
* (% data-category="classes" class="hierarchy-toggleCategory" %)((($iconBulletToggle  (%%)**Classes**)))
(% id='hierarchyCategory_classes' class='hierarchy-list${pageClassHidden}' %)
#set($classesInProjectList = []) ## All classes in the project
#set($pagesInClassesList = []) ## All classes and sheets and templates in the project
#foreach($pageData in $allPagesList)
  #set($pageFullName = $pageData[0])
  #set($classCount = $xwiki.getClass($pageFullName).properties.size())
  #set($document = $xwiki.getDocument($pageFullName))
  #if($classCount &gt; 0 || $document.getObject('XWiki.DocumentSheetBinding').sheet == 'XWiki.ClassSheet')
    #set($ok = $classesInProjectList.add($pageFullName))
    #set($ok = $pagesInClassesList.add($pageFullName))
    #set($pageFullNameEscaped = $escapetool.url($pageFullName).replace("+", "%20"))
    #set($sheetDocList = $services.sheet.getClassSheets($document))
    #set($className = $stringtool.removeEnd($document.name, 'Class'))
    #set($classTemplateReference = $services.model.createDocumentReference($document.wiki, $document.space, "${className}ClassTemplate"))
    #if(!$xwiki.exists($classTemplateReference))
      #set($classTemplateReference = $services.model.createDocumentReference($document.wiki, $document.space, "${className}Template"))
    #end
    #set($classTemplateDoc = $xwiki.getDocument($classTemplateReference))
    #set($pageClassHidden = " hierarchy-hidden")
    #set($iconBulletToggle = "(% class='hierarchyDisplayPageIcon'%)$services.icon.render('caret-right', 'Font Awesome')")
    #if($visiblePages.contains("Class-$pageFullNameEscaped") || $pageFullName == $currentDoc.fullName || $classTemplateDoc.fullName == $currentDoc.fullName || $sheetDocList.contains($currentDoc.getDocumentReference()))
      #set($pageClassHidden = "")
      #set($iconBulletToggle = "(% class='hierarchyDisplayPageIcon'%)$services.icon.render('caret-down', 'Font Awesome')")
    #end
    #set($spaceEscaped = $escapetool.url($document.space).replace("+", "%20"))
    #set($pageEscaped = $escapetool.url($document.name).replace("+", "%20"))
    ** (% data-pageid="Class-$escapetool.url($pageFullName)" class="hierarchy-displayPage" %)((($iconBulletToggle (%%)$services.icon.render('desktop', 'Font Awesome') (% id='hierarchyDisplayPage_$escapetool.url($pageFullName)' class="hierarchyPageName"%)$className)))
    (% id='hierarchyPageDetails_Class-$escapetool.url($pageFullName)' class='hierarchy-list${pageClassHidden}' %)
    *** $services.icon.render('database', 'Font Awesome') [[Edit fields&gt;&gt;path:$document.getURL('edit', 'editor=class#!XWebIDE')||class="editClass" data-page='$pageEscaped' data-space='$spaceEscaped']]
    #if($sheetDocList.size() &gt; 0)
      #foreach($sheetFullName in $sheetDocList)
        #set($addName = "")
        #set($sheetDoc = $xwiki.getDocument($sheetFullName))
        #set($ok = $pagesInClassesList.add($sheetDoc.fullName))
        #set($spaceSheetEscaped = $escapetool.url($sheetDoc.space).replace("+", "%20"))
        #set($pageSheetEscaped = $escapetool.url($sheetDoc.name).replace("+", "%20"))
        #set($titleSheetEscaped = $escapetool.url($sheetDoc.title).replace("+", "%20"))
        #if($sheetDocList.size() &gt; 1)
          #set($addName = " ($sheetDoc.name)")
        #end
        *** $services.icon.render('pencil', 'Font Awesome') [[Edit sheet$addName&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||data-space='$spaceSheetEscaped' data-page='$!pageSheetEscaped' data-locale="default" data-rawtitle='$titleSheetEscaped' class='editPage']]
        (% class="hierarchy-list" %)
        #foreach($jsxObject in $sheetDoc.getObjects('XWiki.JavaScriptExtension'))
          **** $services.icon.render('pencil', 'Font Awesome') [[Edit sheet JS-$jsxObject.number&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||data-space='$spaceSheetEscaped' data-page='$pageSheetEscaped' data-object="XWiki.JavaScriptExtension" data-objectnumber="$jsxObject.number" data-rawtitle="$titleSheetEscaped" class='editObject']]
        #end
        #if($sheetDoc.getObjects('XWiki.JavaScriptExtension').size() == 0)
          **** $services.icon.render('add', 'Font Awesome') [[Add sheet JS&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||class="newJSObject newLocalObject" data-space='$spaceSheetEscaped' data-page='$pageSheetEscaped']]
        #end
        #foreach($ssxObject in $sheetDoc.getObjects('XWiki.StyleSheetExtension'))
          **** $services.icon.render('pencil', 'Font Awesome') [[Edit sheet CSS-$ssxObject.number&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||data-space='$spaceSheetEscaped' data-page='$pageSheetEscaped' data-object="XWiki.StyleSheetExtension" data-objectnumber="$ssxObject.number" data-rawtitle="$titleSheetEscaped" class='editObject']]
        #end
        #if($sheetDoc.getObjects('XWiki.StyleSheetExtension').size() == 0)
          **** $services.icon.render('add', 'Font Awesome') [[Add sheet CSS&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||class="newCSSObject newLocalObject" data-space='$spaceSheetEscaped' data-page='$pageSheetEscaped']]
        #end
      #end
    #else
      *** $services.icon.render('add', 'Font Awesome') [[Add bound sheet&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||class="newPage newSheet" data-page='${pageEscaped}Sheet' data-space='$spaceEscaped' data-locale="default"]]
    #end
    #if(!$classTemplateDoc.isNew())
      #set($ok = $pagesInClassesList.add($classTemplateDoc.fullName))
      *** $services.icon.render('pencil', 'Font Awesome') [[Edit template&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||data-space='$escapetool.url($classTemplateDoc.space).replace("+", "%20")' data-page='$escapetool.url($classTemplateDoc.name).replace("+", "%20")' data-locale="default" data-rawtitle="$escapetool.url($classTemplateDoc.title).replace("+", "%20")" class='editPage']]
    #else
      *** $services.icon.render('add', 'Font Awesome') [[Add template&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||class="newPage newTemplate" data-page='${pageEscaped}Template' data-space='$spaceEscaped' data-locale="default"]]
    #end
  #end
#end
#if($classesInProjectList.size() == 0)
 ** //Empty//
#end
## Display all the pages in the project
#set($pageClassHidden = " hierarchy-hidden")
#set($iconBulletToggle = "(% class='hierarchyDisplayPageIcon'%)$services.icon.render('caret-right', 'Font Awesome')")
#if($visibleCategory.contains("pages"))
  #set($pageClassHidden = "")
  #set($iconBulletToggle = "(% class='hierarchyDisplayPageIcon'%)$services.icon.render('caret-down', 'Font Awesome')")
#end
* (% data-category="pages" class="hierarchy-toggleCategory" %)((($iconBulletToggle  (%%)**Pages**)))
(% id='hierarchyCategory_pages' class='hierarchy-list${pageClassHidden}' %)
#set($oldSpace = '')
#set($spaceCount = 0)
#foreach($pageFullNameData in $allPagesList)
  #set($pageFullName = $pageFullNameData[0])
  #set($pageLocaleList = $pageFullNameData[1])
  #set($pageDoc = $xwiki.getDocument($pageFullName))
  #set($space = $pageDoc.space)
  #set($page = $pageDoc.name)
  #set($jsxList = $pageDoc.getObjects('XWiki.JavaScriptExtension'))
  #set($ssxList = $pageDoc.getObjects('XWiki.StyleSheetExtension'))
  #set($macrosList = $pageDoc.getObjects('XWiki.WikiMacroClass'))
  #set($translationsList = $pageDoc.getObjects('XWiki.TranslationDocumentClass'))
  #set($ok = $allJSList.addAll($jsxList))
  #set($ok = $allCSSList.addAll($ssxList))
  #set($ok = $allMacrosList.addAll($macrosList))
  #set($ok = $allTranslationsList.addAll($translationsList))
  #set($isInClassesList = $pagesInClassesList.contains($pageFullName)) ## Classes should not be displayed in the 'pages' tree
  #set($isGlobal = false)
  #if($space == $codeSpace)
    #if(($page == 'JS' &amp;&amp; $pageDoc.getObjects('XWiki.JavaScriptExtension', 'use', 'always').size()&gt;0) || ($page == 'CSS' &amp;&amp; $pageDoc.getObjects('XWiki.StyleSheetExtension', 'use', 'always').size()&gt;0) || $macrosList.size()&gt;0 || $translationsList.size()&gt;0)
      #set($isGlobal = true)
    #end
  #end
  ## Compute space elements
  #if($space != $oldSpace)
    #set($oldSpace = $space)
    #set($spaceInListInit = $spacesListInit.contains($space)) ##Spaces in the 'spaces' object property
    #set($spaceInListNested = $spacesListNested.contains($space)) ##Spaces to displays
    #set($spaceEscaped = $escapetool.url($space).replace("+", "%20"))
    ## Determine the level of depth of the space to know the number of starrs (level of sublist)
    #set($depthLevel = -1)
    #set($tlist = $space.replace("\.", "%5C%2E").split('\.'))
    #set($spacePath = "")
    #set($Integer = 0)
    #foreach($item in $tlist)
      #set($spacePath = "${spacePath}$item.replace('%5C%2E', '\.')")
      #if($spacesListNested.contains($spacePath))
        #set($depthLevel = $depthLevel+1)
      #end
      #set($spacePath = "${spacePath}.")
    #end
    #set($addStars = $stringtool.repeat('*', $depthLevel))
      ##Determine the name of the subspace (without its parents), use when renaming the folder
    #set($subspaceNameIndex = $tlist.size() - 1)
    #set($subspaceName = $tlist.get($subspaceNameIndex).replace('%5C%2E', '.'))
    #set($subspaceNameEscaped = $escapetool.url($subspaceName).replace("+", "%20"))
    #if($nestedSpaces)
      #set($spaceEscapedBackslash = $escapetool.url($space).replace("+", "%20"))
    #else
      #set($spaceEscapedBackslash = $escapetool.url($space.replace('\', '\\').replace('.', '\.')).replace("+", "%20")) ##"'
    #end
    #if($visibleSpaces.contains($spaceEscapedBackslash) || $spaceParentList.contains($space))
      #set($contentDisplay = "")
      #set($iconBulletToggle = "(% id='hierarchyFolderIcon_$spaceEscapedBackslash'%)$services.icon.render('caret-down', 'Font Awesome')") ##'"
    #else
      #set($contentDisplay = " hierarchy-hidden")
      #set($iconBulletToggle = "(% id='hierarchyFolderIcon_$spaceEscapedBackslash'%)$services.icon.render('caret-right', 'Font Awesome')") ##'"
    #end
    #if($pageCount &amp;&amp; $pageCount == 0)
      $addStars*** //Empty//
    #end
    #set($spaceCount = $spaceCount + 1)
    $addStars** (% class="hierarchy-toggleFolder" data-space="$spaceEscapedBackslash" %)((($iconBulletToggle (%%)$services.icon.render('folder', 'Font Awesome') (% id="hierarchyDisplaySpace_$spaceEscaped" class="hierarchySpaceName" %)$subspaceName(%%) )))
    (% id="hierarchySpace_$spaceEscapedBackslash" class="hierarchy-list${contentDisplay}" %)
    #set($pageCount = 0)
  #end
  #if(!$isInClassesList &amp;&amp; !$isGlobal)
    ## Compute page elements
    #if(!$pageDoc.isNew()) ##TODO
      #set($pageEscaped = $escapetool.url($page).replace("+", "%20"))
      #if($nestedSpaces)
        #set($pageEscapedBackslash = $escapetool.url($page).replace("+", "%20"))
      #else
        #set($pageEscapedBackslash = $escapetool.url($page.replace('\', '\\').replace('.', '\.')).replace("+", "%20")) ##"'
      #end
      #set($pageInPagesList = $pagesList.contains($pageFullName))
      #set($pageFullNameEscaped = $escapetool.url($pageFullName).replace("+", "%20"))
      #set($pageRawTitleEscaped = $escapetool.url($xwiki.getDocument($pageFullName).title).replace("+", "%20"))
      #set($pageClassHidden = " hierarchy-hidden")
      #set($iconBulletToggle = "(% class='hierarchyDisplayPageIcon'%)$services.icon.render('caret-right', 'Font Awesome')")
      #if($visiblePages.contains($pageFullNameEscaped) || $pageFullName == $currentDoc.fullName)
        #set($pageClassHidden = "")
        #set($iconBulletToggle = "(% class='hierarchyDisplayPageIcon'%)$services.icon.render('caret-down', 'Font Awesome')")
      #end
      #set($pageName = "(% id='hierarchyDisplayPage_$pageFullNameEscaped' class='hierarchyPageName'%)$page)))") ##'"
      #if($xwiki.getDocument($pageFullName).hasAccessLevel('edit'))
        #set($pageCount = $pageCount + 1)
        #set($itemPage = false)
        #foreach($className in $classesInProjectList)
          #if($pageDoc.getObject($className))
            #set($itemPage = true)
            #break
          #end
        #end
        #if($itemPage) ##It's an "Item" page
          $addStars*** $services.icon.render('drive', 'Font Awesome') [[$page&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||data-space='$spaceEscaped' data-page='$pageEscaped' data-rawtitle="$pageRawTitleEscaped" class='editObject']]
        #else ##It's an "Content" page
          $addStars*** (% data-pageid="$spaceEscapedBackslash.$pageEscapedBackslash" class="hierarchy-displayPage" %)((($iconBulletToggle (%%)$services.icon.render('page', 'Font Awesome') $pageName
        (% id='hierarchyPageDetails_$spaceEscapedBackslash.$pageEscapedBackslash' class='hierarchy-list${pageClassHidden}' %)
          #if($pageLocaleList.size() == 0)
            #set($ok = $pageLocaleList.add('default'))
          #end
          #foreach($pageLocale in $pageLocaleList)
            #set($pageLocaleDisplay = "")
            #if($pageLocale != "default" &amp;&amp; "$!pageLocale" != "")
              #set($pageLocaleDisplay = " ($pageLocale)")
            #end
            #if($velocityCount == 1)
              #set($pageLocale = 'default')
            #end
            $addStars**** $services.icon.render('pencil', 'Font Awesome') [[Edit content$!pageLocaleDisplay&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||data-locale="$pageLocale" data-space='$spaceEscaped' data-page='$pageEscaped' data-rawtitle="$pageRawTitleEscaped" class='editPage']]
          #end
          #foreach($jsxObject in $jsxList)
            #if($jsxObject.getProperty('use').value == "onDemand" || $jsxObject.getProperty('use').value == "currentPage" || !$jsxObject.getProperty('use').value)
              $addStars**** $services.icon.render('pencil', 'Font Awesome') [[Edit JS-$jsxObject.number&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||data-space='$spaceEscaped' data-page='$pageEscaped' data-object="XWiki.JavaScriptExtension" data-objectnumber="$jsxObject.number" data-rawtitle="$pageRawTitleEscaped" class='editObject']]
            #end
          #end
          #foreach($ssxObject in $ssxList)
            #if($ssxObject.getProperty('use').value == "onDemand" || $ssxObject.getProperty('use').value == "currentPage" || !$ssxObject.getProperty('use').value)
              $addStars**** $services.icon.render('pencil', 'Font Awesome') [[Edit CSS-$ssxObject.number&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||data-space='$spaceEscaped' data-page='$pageEscaped' data-object="XWiki.StyleSheetExtension" data-objectnumber="$ssxObject.number"  data-rawtitle="$pageRawTitleEscaped" class='editObject']]
            #end
          #end
          #if($jsxList.size() == 0)
            $addStars**** $services.icon.render('add', 'Font Awesome') [[Add local JS&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||class="newJSObject newLocalObject" data-space='$spaceEscaped' data-page='$pageEscaped']]
          #end
          #if($ssxList.size() == 0)
            $addStars**** $services.icon.render('add', 'Font Awesome') [[Add local CSS&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||class="newCSSObject newLocalObject" data-space='$spaceEscaped' data-page='$pageEscaped']]
          #end
        #end
      #end
    #end
  #end
#end
#if($spaceCount == 0)
  ** //Empty//
#end
## JS
#set($pageClassHidden = " hierarchy-hidden")
#set($iconBulletToggle = "(% class='hierarchyDisplayPageIcon'%)$services.icon.render('caret-right', 'Font Awesome')")
#if($visibleCategory.contains("js"))
  #set($pageClassHidden = "")
  #set($iconBulletToggle = "(% class='hierarchyDisplayPageIcon'%)$services.icon.render('caret-down', 'Font Awesome')")
#end
* (% data-category="js" class="hierarchy-toggleCategory" %)((($iconBulletToggle  (%%)**JavaScript**)))
(% id='hierarchyCategory_js' class='hierarchy-list${pageClassHidden}' %)
#set($jsCount = 0)
#foreach($jsxObject in $allJSList)
  #if($jsxObject.getProperty('use').value == 'always')
    #set($jsCount = $jsCount + 1)
    #set($objDoc = $xwiki.getDocument($jsxObject.name))
    #set($spaceEscaped = $escapetool.url($objDoc.space).replace("+", "%20"))
    #set($pageEscaped = $escapetool.url($objDoc.name).replace("+", "%20"))
    #set($titleEscaped = $escapetool.url($objDoc.title).replace("+", "%20"))
    #set($docName = $objDoc.name)
    #if("$!jsxObject.getProperty('name').value" != "")
      #set($docName = $jsxObject.getProperty('name').value)
    #end
    ** $services.icon.render('drive', 'Font Awesome') [[$docName&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||data-space='$spaceEscaped' data-page='$pageEscaped' data-object="XWiki.JavaScriptExtension" data-objectnumber="$jsxObject.number" data-rawtitle="$titleEscaped" class='editObject']]
  #end
#end
#if($jsCount == 0)
 ** //Empty//
#end
## CSS
#set($pageClassHidden = " hierarchy-hidden")
#set($iconBulletToggle = "(% class='hierarchyDisplayPageIcon'%)$services.icon.render('caret-right', 'Font Awesome')")
#if($visibleCategory.contains("css"))
  #set($pageClassHidden = "")
  #set($iconBulletToggle = "(% class='hierarchyDisplayPageIcon'%)$services.icon.render('caret-down', 'Font Awesome')")
#end
* (% data-category="css" class="hierarchy-toggleCategory" %)((($iconBulletToggle  (%%)**CSS**)))
(% id='hierarchyCategory_css' class='hierarchy-list${pageClassHidden}' %)
#set($cssCount = 0)
#foreach($ssxObject in $allCSSList)
  #if($ssxObject.getProperty('use').value == 'always')
    #set($cssCount = $cssCount + 1)
    #set($objDoc = $xwiki.getDocument($ssxObject.name))
    #set($spaceEscaped = $escapetool.url($objDoc.space).replace("+", "%20"))
    #set($pageEscaped = $escapetool.url($objDoc.name).replace("+", "%20"))
    #set($titleEscaped = $escapetool.url($objDoc.title).replace("+", "%20"))
    #set($docName = $objDoc.name)
    #if("$!ssxObject.getProperty('name').value" != "")
      #set($docName = $ssxObject.getProperty('name').value)
    #end
    ** $services.icon.render('drive', 'Font Awesome') [[$docName&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||data-space='$spaceEscaped' data-page='$pageEscaped' data-object="XWiki.StyleSheetExtension" data-objectnumber="$ssxObject.number" data-rawtitle="$titleEscaped" class='editObject']]
  #end
#end
#if($cssCount == 0)
 ** //Empty//
#end
## Macros
#set($pageClassHidden = " hierarchy-hidden")
#set($iconBulletToggle = "(% class='hierarchyDisplayPageIcon'%)$services.icon.render('caret-right', 'Font Awesome')")
#if($visibleCategory.contains("macros"))
  #set($pageClassHidden = "")
  #set($iconBulletToggle = "(% class='hierarchyDisplayPageIcon'%)$services.icon.render('caret-down', 'Font Awesome')")
#end
* (% data-category="macros" class="hierarchy-toggleCategory" %)((($iconBulletToggle  (%%)**Macros**)))
(% id='hierarchyCategory_macros' class='hierarchy-list${pageClassHidden}' %)
#set($macrosCount = 0)
#foreach($macroObject in $allMacrosList)
  #if($macroObject.getProperty('visibility').value != 'Current User')
    #set($macrosCount = $macrosCount + 1)
    #set($objDoc = $xwiki.getDocument($macroObject.name))
    #set($spaceEscaped = $escapetool.url($objDoc.space).replace("+", "%20"))
    #set($pageEscaped = $escapetool.url($objDoc.name).replace("+", "%20"))
    #set($titleEscaped = $escapetool.url($objDoc.title).replace("+", "%20"))
    #set($docName = $objDoc.name)
    #if("$!macroObject.getProperty('name').value" != "")
      #set($docName = $macroObject.getProperty('name').value)
    #end
    ** $services.icon.render('drive', 'Font Awesome') [[$docName&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||data-space='$spaceEscaped' data-page='$pageEscaped' data-object="XWiki.WikiMacroClass" data-objectnumber="$macroObject.number" data-rawtitle="$titleEscaped" class='editObject']]
  #end
#end
## Translations
#if($macrosCount == 0)
 ** //Empty//
#end
#set($pageClassHidden = " hierarchy-hidden")
#set($iconBulletToggle = "(% class='hierarchyDisplayPageIcon'%)$services.icon.render('caret-right', 'Font Awesome')")
#if($visibleCategory.contains("translations"))
  #set($pageClassHidden = "")
  #set($iconBulletToggle = "(% class='hierarchyDisplayPageIcon'%)$services.icon.render('caret-down', 'Font Awesome')")
#end
* (% data-category="translations" class="hierarchy-toggleCategory" %)((($iconBulletToggle  (%%)**Translations**)))
(% id='hierarchyCategory_translations' class='hierarchy-list${pageClassHidden}' %)
#foreach($translationObj in $allTranslationsList)
  #set($objDoc = $xwiki.getDocument($translationObj.name))
  #set($docName = $objDoc.name)
  #set($spaceEscaped = $escapetool.url($objDoc.space).replace("+", "%20"))
  #set($pageEscaped = $escapetool.url($objDoc.name).replace("+", "%20"))
  #if($nestedSpaces)
    #set($pageFullName = "${objDoc.space}.${docName.replace('\', '\\').replace('.', '\.')}") ##'"
    #set($spaceEscapedBackslash = $escapetool.url($objDoc.space).replace("+", "%20"))
    #set($pageEscapedBackslash = $escapetool.url($docName).replace("+", "%20"))
  #else
    #set($pageFullName = "${objDoc.space.replace('\', '\\').replace('.', '\.')}.${docName.replace('\', '\\').replace('.', '\.')}") ##'"
    #set($spaceEscapedBackslash = $escapetool.url($objDoc.space.replace('\', '\\').replace('.', '\.')).replace("+", "%20")) ##'
    #set($pageEscapedBackslash = $escapetool.url($docName.replace('\', '\\').replace('.', '\.')).replace("+", "%20")) ##'
  #end
  #set($pageFullNameEscaped = $escapetool.url($pageFullName).replace("+", "%20"))
  #set($titleEscaped = $escapetool.url($objDoc.title).replace("+", "%20"))
  #set($pageClassHidden = " hierarchy-hidden")
  #set($iconBulletToggle = "(% class='hierarchyDisplayPageIcon'%)$services.icon.render('caret-right', 'Font Awesome')")
  #if($visiblePages.contains("Tr-$pageFullNameEscaped") || $pageFullName == $currentDoc.fullName)
    #set($pageClassHidden = "")
    #set($iconBulletToggle = "(% class='hierarchyDisplayPageIcon'%)$services.icon.render('caret-down', 'Font Awesome')")
  #end
  #set($pageLocaleList = $objDoc.getTranslationList())
  #set($pageLocaleList = $sorttool.sort($pageLocaleList))
  #set($ok = $pageLocaleList.add(0, $objDoc.defaultLanguage))
  ** (% data-pageid="Tr-$spaceEscapedBackslash.$pageEscapedBackslash" class="hierarchy-displayPage" %)((($iconBulletToggle  (%%)$services.icon.render('page', 'Font Awesome') (%%)$docName )))
  (% id='hierarchyPageDetails_Tr-$spaceEscapedBackslash.$pageEscapedBackslash' class='hierarchy-list${pageClassHidden}' %)
   *** image:icon:add [[Add a language&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||class="newPage newLanguage" data-space="$spaceEscaped" data-page="$pageEscaped" data-toggle="modal" data-target="#hierarchyPageModal"]]
  #foreach($pageLocale in $pageLocaleList)
    #if($pageLocale == "")
      #set($pageLocale = "default")
      #set($displayLanguage = "Default")
    #else
      #set($language = $services.localization.toLocale($pageLocale).getDisplayLanguage())
      #set($displayLanguage = $language)
      #if($language.length() &gt; 0)
        #set($displayLanguage = "${language.substring(0, 1).toUpperCase()}${language.substring(1)}")
      #end
    #end
    *** $services.icon.render('pencil', 'Font Awesome') [[$displayLanguage&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||data-locale="$pageLocale" data-space='$spaceEscaped' data-page='$pageEscaped' data-rawtitle="$titleEscaped" class='editPage']]
  #end
#end
#if($allTranslationsList.size() == 0)
 ** //Empty//
#end
{{html clean=false}}
&lt;div id="hierarchyUpdatedClassList" class="hierarchy-hidden"&gt;#foreach($class in $classesInProjectList)
  #set($classDoc = $xwiki.getDocument($class))
    &lt;option value="$escapetool.url($class).replace('+', '%20')"&gt;$classDoc.name&lt;/option&gt;
#end&lt;/div&gt;
{{/html}}
{{/velocity}}</content>
</xwikidoc>
