<?xml version="1.0" encoding="UTF-8"?>

<!--
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
-->

<xwikidoc reference="WebIDECode.LogicalTree" locale="">
  <web>WebIDECode</web>
  <name>LogicalTree</name>
  <language/>
  <defaultLanguage/>
  <translation>0</translation>
  <parent>WebIDECode.ApplicationHierarchy</parent>
  <creator>xwiki:XWiki.Admin</creator>
  <author>xwiki:XWiki.Admin</author>
  <customClass/>
  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>
  <creationDate>1445347285000</creationDate>
  <date>1450714504000</date>
  <contentUpdateDate>1450176503000</contentUpdateDate>
  <version>1.1</version>
  <title>LogicalTree</title>
  <defaultTemplate/>
  <validationScript/>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.1</syntaxId>
  <hidden>true</hidden>
  <content>{{velocity}}
#if($masterDoc.hasAccessLevel('edit'))
{{html wiki="true"}}
  &lt;form method="post" action="$masterDoc.getURL('view')" class="masterExportForm"&gt;&lt;input type="hidden" name="export" value="1" /&gt;#if($singlePage)&lt;input type="hidden" name="singlePage" value="$escapetool.url($currentDoc.fullName).replace('+', '%20')" /&gt;#end&lt;input class="btn btn-default hierarchy-export-button" type="submit" value="$services.localization.render('webide.menu.export')" title="$services.localization.render('webide.menu.export')"/&gt;&lt;/form&gt;
{{/html}}
#end
#set($codeSpace = "${doc.space}Code")
#if($masterDoc.codeSpace)
  #set($codeSpace = $masterDoc.codeSpace)
#end
#set($allPagesList = [])
## Global categories
#set($allJSList = [])
#set($allCSSList = [])
#set($allMacrosList = [])
#set($allPanelsList = [])
#set($allTranslationsList = [])
#set($allUIXList = [])
## Get a list of all the pages in the project
#set($spacesList = $sorttool.sort($spacesList))
#foreach($space in $spacesList)
  #set($spaceInListNested = $spacesListNested.contains($space))
  #if($spaceInListNested)
    #set($xwql = "select distinct doc.name, doc.space from Document doc where doc.space=:space order by doc.name asc")
    #set($spacePageList = $services.query.xwql($xwql).bindValue('space', $space).execute())
    #foreach($element in $spacePageList)
      #set($spaceName = $element[1])
      #if(!$nestedSpaces)
        #set($spaceName = $element[1].replace('\', '\\').replace('.', '\.'))##'
      #end
      #set($pageName = $element[0].replace('\', '\\').replace('.', '\.'))##'
      #set($localeList = $xwiki.getDocument("$spaceName.$pageName").getTranslationList())
      #set($localeList = $sorttool.sort($localeList))
      #if($localeList.size() &gt; 0)
        #set($ok = $localeList.add(0, $xwiki.getDocument("$spaceName.$pageName").defaultLanguage))
      #end
      #if(!$allPagesList.contains(["$spaceName.$pageName", $localeList]))
        #set($ok = $allPagesList.add(["$spaceName.$pageName", $localeList]))
      #end
    #end
    #if($spacePageList.size() == 0)
      #set($ok = $allPagesList.add(["$space.$reservedDocumentName", []]))
    #end
  #else
    #set($spacePageList = [])
    #foreach($page in $pagesList)
      #set($document = $xwiki.getDocument($page))
      #set($localeList = $document.getTranslationList())
      #set($localeList = $sorttool.sort($localeList))
      #if($localeList.size() &gt; 0)
        #set($ok = $localeList.add(0, $document.defaultLanguage))
      #end
      #if($space == $document.space &amp;&amp; !$allPagesList.contains([$document.fullName, $localeList]))
        #set($ok = $allPagesList.add([$document.fullName, $localeList]))
      #end
    #end
  #end
#end
## **************************************
## Display all the classes in the project
## **************************************
(% class="hierarchy-list hierarchy-no-padding" id="hierarchyMainList" %)
#set($pageClassHidden = " hierarchy-hidden")
#set($iconBulletToggle = "(% class='hierarchyDisplayPageIcon'%){{html clean='false'}}&lt;span class='fa fa-caret-right'&gt;&lt;/span&gt;{{/html}}")
#if($visibleCategory.contains("classes"))
  #set($pageClassHidden = "")
  #set($iconBulletToggle = "(% class='hierarchyDisplayPageIcon'%){{html clean='false'}}&lt;span class='fa fa-caret-down'&gt;&lt;/span&gt;{{/html}}")
#end
#set($addLinks = "&lt;li&gt;&lt;a href='#' class='newAWMClass newClass' data-space='$escapetool.url($codeSpace).replace('+', '%20')' data-toggle='modal' data-target='#hierarchyClassModal'&gt;$services.localization.render('webide.menu.category.classes.add')&lt;/a&gt;&lt;/li&gt;")
* $beginAddButton$addLinks$endAddButton (% data-category="classes" class="hierarchy-toggleCategory" %)((($iconBulletToggle  (%%)**$services.localization.render('webide.menu.category.classes')**)))
(% id='hierarchyCategory_classes' class='hierarchy-list${pageClassHidden}' %)
#set($classesInProjectList = []) ## All classes in the project
#set($pagesInClassesList = []) ## All classes and sheets and templates in the project
#foreach($pageData in $allPagesList)
  #set($pageFullName = $pageData[0])
  #set($classCount = $xwiki.getClass($pageFullName).properties.size())
  #set($document = $xwiki.getDocument($pageFullName))
  #if($classCount &gt; 0 || $document.getObject('XWiki.DocumentSheetBinding').sheet == 'XWiki.ClassSheet')
    #set($ok = $classesInProjectList.add($pageFullName))
    #set($ok = $pagesInClassesList.add($pageFullName))
    #set($pageFullNameEscaped = $escapetool.url($pageFullName).replace("+", "%20"))
    #set($sheetDocList = $services.sheet.getClassSheets($document))
    #set($className = $stringtool.removeEnd($document.name, 'Class'))
    #set($classTemplateReference = $services.model.createDocumentReference($document.wiki, $document.space, "${className}ClassTemplate"))
    #if(!$xwiki.exists($classTemplateReference))
      #set($classTemplateReference = $services.model.createDocumentReference($document.wiki, $document.space, "${className}Template"))
    #end
    #set($classTemplateDoc = $xwiki.getDocument($classTemplateReference))
    #set($pageClassHidden = " hierarchy-hidden")
    #set($iconBulletToggle = "(% class='hierarchyDisplayPageIcon'%){{html clean='false'}}&lt;span class='fa fa-caret-right'&gt;&lt;/span&gt;{{/html}}")
    #if($visiblePages.contains("Class-$pageFullNameEscaped") || $pageFullName == $currentDoc.fullName || $classTemplateDoc.fullName == $currentDoc.fullName || $sheetDocList.contains($currentDoc.getDocumentReference()))
      #set($pageClassHidden = "")
      #set($iconBulletToggle = "(% class='hierarchyDisplayPageIcon'%){{html clean='false'}}&lt;span class='fa fa-caret-down'&gt;&lt;/span&gt;{{/html}}")
    #end
    #set($spaceEscaped = $escapetool.url($document.space).replace("+", "%20"))
    #set($pageEscaped = $escapetool.url($document.name).replace("+", "%20"))
    #set($addLinks = "&lt;li&gt;&lt;a href='#' class='newAWMClass newSheet' data-page='$pageEscaped' data-space='$spaceEscaped' data-locale='default' data-toggle='modal' data-target='#hierarchyClassModal'&gt;$services.localization.render('webide.menu.category.classes.addSheet')&lt;/a&gt;&lt;/li&gt;") ##'
    #if($classTemplateDoc.isNew())
      #set($addLinks = "${addLinks}&lt;li&gt;&lt;a href='#' class='newAWMClass newTemplate' data-page='$pageEscaped' data-space='$spaceEscaped' data-locale='default'&gt;$services.localization.render('webide.menu.category.classes.addTemplate')&lt;/a&gt;&lt;/li&gt;") ##'"
    #end
  #set($removeLinks = "")
  #set($removeBlock = "")
  #set($removeLinks = "$!removeLinks&lt;li&gt;&lt;a href='#' class='deleteAWM' data-space='$spaceEscaped' data-page='$pageEscaped'&gt;$services.localization.render('webide.menu.remove.page')&lt;/a&gt;&lt;/li&gt;") ##'"
  #if("$!removeLinks" != "")
    #set($removeBlock = "$beginRemoveButton$removeLinks$endRemoveButton")
  #end
    ** $beginAddButton$addLinks$endAddButton $!removeBlock (% data-pageid="Class-$escapetool.url($pageFullName)" class="hierarchy-displayPage" %)((($iconBulletToggle (%%){{html clean='false'}}&lt;span class='fa fa-desktop'&gt;&lt;/span&gt;{{/html}} (% id='hierarchyDisplayPage_$escapetool.url($pageFullName)' class="hierarchyPageName"%)$className)))
    (% id='hierarchyPageDetails_Class-$escapetool.url($pageFullName)' class='hierarchy-list${pageClassHidden}' %)
    *** {{html clean='false'}}&lt;span class='fa fa-database'&gt;&lt;/span&gt;{{/html}} [[$services.localization.render('webide.menu.view.logical.editClass')&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||class="editAWM" data-page='$pageEscaped' data-space='$spaceEscaped']]
    #if($sheetDocList.size() &gt; 0)
      #foreach($sheetFullName in $sheetDocList)
        #set($addName = "")
        #set($sheetDoc = $xwiki.getDocument($sheetFullName))
        #if(!$sheetDoc.isNew())
          #set($ok = $pagesInClassesList.add($sheetDoc.fullName))
          #set($spaceSheetEscaped = $escapetool.url($sheetDoc.space).replace("+", "%20"))
          #set($pageSheetEscaped = $escapetool.url($sheetDoc.name).replace("+", "%20"))
          #set($titleSheetEscaped = $escapetool.url($sheetDoc.title).replace("+", "%20"))
          #set($pageParentEscaped = $escapetool.url($sheetDoc.parent).replace("+", "%20"))
          #if($sheetDoc.getObject("XWiki.SheetDescriptorClass"))
            #set($addName = " ($sheetDoc.action)")
          #elseif($sheetDocList.size() &gt; 1)
            #set($addName = " ($sheetDoc.name)")
          #end
          #set($addLinks = "&lt;li&gt;&lt;a href='#' class='newJSObject newLocalObject' data-space='$spaceSheetEscaped' data-page='$pageSheetEscaped'&gt;$services.localization.render('webide.menu.add.localJS')&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href='#' class='newCSSObject newLocalObject' data-space='$spaceSheetEscaped' data-page='$pageSheetEscaped'&gt;$services.localization.render('webide.menu.add.localCSS')&lt;/a&gt;&lt;/li&gt;") ##'"
          #set($removeLinks = "")
          #set($removeBlock = "")
          #set($removeLinks = "$!removeLinks&lt;li&gt;&lt;a href='#' class='deletePage' data-space='$spaceSheetEscaped' data-page='$pageSheetEscaped' data-locale='default'&gt;$services.localization.render('webide.menu.remove.page')&lt;/a&gt;&lt;/li&gt;") ##'"
          #if("$!removeLinks" != "")
            #set($removeBlock = "$beginRemoveButton$removeLinks$endRemoveButton")
          #end
          *** $beginAddButton$addLinks$endAddButton {{html clean='false'}}&lt;span class='fa fa-pencil'&gt;&lt;/span&gt;{{/html}} $!removeBlock [[$services.localization.render('webide.menu.view.logical.editSheet')$addName&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||data-space='$spaceSheetEscaped' data-page='$!pageSheetEscaped' data-locale="default" data-rawtitle='$titleSheetEscaped' data-parent="$pageParentEscaped" data-hidden="$sheetDoc.isHidden()" class='editPage']]
          #if($sheetDoc.getObjects('XWiki.JavaScriptExtension').size() != 0 || $sheetDoc.getObjects('XWiki.StyleSheetExtension').size() != 0)
            (% class="hierarchy-list" %)
          #end
          #foreach($jsxObject in $sheetDoc.getObjects('XWiki.JavaScriptExtension'))
            #set($removeLinks = "")
            #set($removeBlock = "")
            #set($removeLinks = "$!removeLinks&lt;li&gt;&lt;a href='#' class='deleteObject' data-space='$spaceSheetEscaped' data-page='$pageSheetEscaped' data-object='XWiki.JavaScriptExtension' data-objectnumber='$jsxObject.number'&gt;$services.localization.render('webide.menu.remove.object')&lt;/a&gt;&lt;/li&gt;") ##'"
            #if("$!removeLinks" != "")
              #set($removeBlock = "$beginRemoveButton$removeLinks$endRemoveButton")
            #end
            **** {{html clean='false'}}&lt;span class='fa fa-pencil'&gt;&lt;/span&gt;{{/html}} $!removeBlock [[$services.localization.render('webide.menu.view.logical.edit') JS-$jsxObject.number&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||data-space='$spaceSheetEscaped' data-page='$pageSheetEscaped' data-object="XWiki.JavaScriptExtension" data-objectnumber="$jsxObject.number" class='editObject']]
          #end
          #foreach($ssxObject in $sheetDoc.getObjects('XWiki.StyleSheetExtension'))
            #set($removeLinks = "")
            #set($removeBlock = "")
            #set($removeLinks = "$!removeLinks&lt;li&gt;&lt;a href='#' class='deleteObject' data-space='$spaceSheetEscaped' data-page='$pageSheetEscaped' data-object='XWiki.StyleSheetExtension' data-objectnumber='$ssxObject.number'&gt;$services.localization.render('webide.menu.remove.object')&lt;/a&gt;&lt;/li&gt;") ##'"
            #if("$!removeLinks" != "")
              #set($removeBlock = "$beginRemoveButton$removeLinks$endRemoveButton")
            #end
            **** {{html clean='false'}}&lt;span class='fa fa-pencil'&gt;&lt;/span&gt;{{/html}} $!removeBlock [[$services.localization.render('webide.menu.view.logical.edit') CSS-$ssxObject.number&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||data-space='$spaceSheetEscaped' data-page='$pageSheetEscaped' data-object="XWiki.StyleSheetExtension" data-objectnumber="$ssxObject.number" class='editObject']]
          #end
        #end
      #end
    #end
    #if(!$classTemplateDoc.isNew())
      #set($ok = $pagesInClassesList.add($classTemplateDoc.fullName))
      #set($removeLinks = "")
      #set($removeBlock = "")
      #set($removeLinks = "&lt;li&gt;&lt;a href='#' class='deletePage' data-space='$escapetool.url($classTemplateDoc.space).replace('+', '%20')' data-page='$escapetool.url($classTemplateDoc.name).replace('+', '%20')' data-locale='default'&gt;$services.localization.render('webide.menu.remove.page')&lt;/a&gt;&lt;/li&gt;") ##'"
      #if("$!removeLinks" != "")
        #set($removeBlock = "$beginRemoveButton$removeLinks$endRemoveButton")
      #end
      *** {{html clean='false'}}&lt;span class='fa fa-hdd-o'&gt;&lt;/span&gt;{{/html}} $!removeBlock [[$services.localization.render('webide.menu.view.logical.editTemplate')&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||data-space='$escapetool.url($classTemplateDoc.space).replace("+", "%20")' data-page='$escapetool.url($classTemplateDoc.name).replace("+", "%20")' data-object="$pageFullNameEscaped" data-objectnumber="0" data-locale="default" class='editObject']]
    #end
  #end
#end
#if($classesInProjectList.size() == 0)
 ** $services.localization.render('webide.menu.empty')
#end
## **************************************
## Display all the pages in the project
## **************************************
#set($pageClassHidden = " hierarchy-hidden")
#set($iconBulletToggle = "(% class='hierarchyDisplayPageIcon'%){{html clean='false'}}&lt;span class='fa fa-caret-right'&gt;&lt;/span&gt;{{/html}}")
#if($visibleCategory.contains("pages"))
  #set($pageClassHidden = "")
  #set($iconBulletToggle = "(% class='hierarchyDisplayPageIcon'%){{html clean='false'}}&lt;span class='fa fa-caret-down'&gt;&lt;/span&gt;{{/html}}")
#end
#set($addLinks = "&lt;li&gt;&lt;a href='#' class='newFolder' data-toggle='modal' data-target='#hierarchyFolderModal'&gt;$services.localization.render('webide.menu.category.pages.addSpace')&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href='#' class='newExistingPage' data-toggle='modal' data-target='#hierarchyExistingPageModal'&gt;$services.localization.render('webide.menu.category.pages.addExistingPage')&lt;/a&gt;&lt;/li&gt;")
* $beginAddButton$addLinks$endAddButton (% data-category="pages" class="hierarchy-toggleCategory" %)((($iconBulletToggle  (%%)**$services.localization.render('webide.menu.category.pages')**)))
(% id='hierarchyCategory_pages' class='hierarchy-list${pageClassHidden}' %)
#set($oldSpace = '')
#set($spaceCount = 0)
#foreach($pageFullNameData in $allPagesList)
  #set($pageFullName = $pageFullNameData[0])
  #set($pageLocaleList = $pageFullNameData[1])
  #set($pageDoc = $xwiki.getDocument($pageFullName))
  #set($space = $pageDoc.space)
  #set($page = $pageDoc.name)
  ## Get objects in the page
  #set($jsxList = $pageDoc.getObjects('XWiki.JavaScriptExtension'))
  #set($ssxList = $pageDoc.getObjects('XWiki.StyleSheetExtension'))
  #set($docSheetList = $pageDoc.getObjects('XWiki.DocumentSheetBinding'))
  ## START - Remove from the "Pages" category elements that should be displayed separately
  #set($macrosList = $pageDoc.getObjects('XWiki.WikiMacroClass'))
  #set($panelsList = $pageDoc.getObjects('Panels.PanelClass'))
  #set($translationsList = $pageDoc.getObjects('XWiki.TranslationDocumentClass'))
  #set($uIXList = $pageDoc.getObjects('XWiki.UIExtensionClass'))
  #set($ok = $allJSList.addAll($jsxList))
  #set($ok = $allCSSList.addAll($ssxList))
  #set($ok = $allMacrosList.addAll($macrosList))
  #set($ok = $allPanelsList.addAll($panelsList))
  #set($ok = $allTranslationsList.addAll($translationsList))
  #set($ok = $allUIXList.addAll($uIXList))
  #set($isInClassesList = $pagesInClassesList.contains($pageFullName)) ## Classes should not be displayed in the 'pages' tree
  #set($isGlobal = false)
  #if(($space == $codeSpace &amp;&amp; ($page == 'JS' &amp;&amp; $pageDoc.getObjects('XWiki.JavaScriptExtension', 'use', 'always').size()&gt;0) || ($page == 'CSS' &amp;&amp; $pageDoc.getObjects('XWiki.StyleSheetExtension', 'use', 'always').size()&gt;0)) || $macrosList.size()&gt;0 || $panelsList.size()&gt;0 || $translationsList.size()&gt;0)
    #set($isGlobal = true) ## Means the page won't be displayed in the "Pages" category
  #end
  ## END - Remove
  ## Compute space elements
  #if($space != $oldSpace)
    #set($oldSpace = $space)
    #set($spaceInListInit = $spacesListInit.contains($space)) ##Spaces in the 'spaces' object property
    #set($spaceInListNested = $spacesListNested.contains($space)) ##Spaces to displays
    #set($spaceEscaped = $escapetool.url($space).replace("+", "%20"))
    ## Determine the level of depth of the space to know the number of starrs (level of sublist)
    #set($depthLevel = -1)
    #set($tlist = $space.replace("\.", "%5C%2E").split('\.'))
    #set($spacePath = "")
    #set($Integer = 0)
    #foreach($item in $tlist)
      #set($spacePath = "${spacePath}$item.replace('%5C%2E', '\.')")
      #if($spacesListNested.contains($spacePath))
        #set($depthLevel = $depthLevel+1)
      #end
      #set($spacePath = "${spacePath}.")
    #end
    #set($addStars = $stringtool.repeat('*', $depthLevel))
      ##Determine the name of the subspace (without its parents), use when renaming the folder
    #set($subspaceNameIndex = $tlist.size() - 1)
    #set($subspaceName = $tlist.get($subspaceNameIndex).replace('%5C%2E', '.'))
    #set($subspaceNameEscaped = $escapetool.url($subspaceName).replace("+", "%20"))
    #if($nestedSpaces)
      #set($spaceEscapedBackslash = $escapetool.url($space).replace("+", "%20"))
    #else
      #set($spaceEscapedBackslash = $escapetool.url($space.replace('\', '\\').replace('.', '\.')).replace("+", "%20")) ##"'
    #end
    #if($visibleSpaces.contains($spaceEscapedBackslash) || $spaceParentList.contains($space))
      #set($contentDisplay = "")
      #set($iconBulletToggle = "(% id='hierarchyFolderIcon_$spaceEscapedBackslash'%){{html clean='false'}}&lt;span class='fa fa-caret-down'&gt;&lt;/span&gt;{{/html}}") ##'"
    #else
      #set($contentDisplay = " hierarchy-hidden")
      #set($iconBulletToggle = "(% id='hierarchyFolderIcon_$spaceEscapedBackslash'%){{html clean='false'}}&lt;span class='fa fa-caret-right'&gt;&lt;/span&gt;{{/html}}") ##'"
    #end
    #if($pageCount &amp;&amp; $pageCount == 0)
      $addStars*** $services.localization.render('webide.menu.empty')
    #end
    #set($spaceCount = $spaceCount + 1)
    #set($renameButton = "")
    #set($renameForm = "")
    #set($removeLinks = "")
    #set($removeBlock = "")
    #set($addLinks = "&lt;li&gt;&lt;a href='#' class='newPage' data-toggle='modal' data-space='$spaceEscaped' data-target='#hierarchyPageModal'&gt;$services.localization.render('webide.menu.category.pages.addPage')&lt;/a&gt;&lt;/li&gt;") ##'"
    #if($spaceInListInit &amp;&amp; $masterDoc.hasAccessLevel('edit'))
      #set($removeLinks = "&lt;li&gt;&lt;a href='#' data-space='$spaceEscaped' class='hierarchy-remove-folder'&gt;$services.localization.render('webide.menu.remove.project')&lt;/a&gt;&lt;/li&gt;") ##'"
    #end
    #if($spaceInListNested &amp;&amp; $masterDoc.hasAccessLevel('edit') &amp;&amp; $xwiki.hasAccessLevel('edit', "$spaceEscaped.$reservedDocumentName"))
      #set($renameButton = "{{html clean=false}}&lt;div class='btn-group hierarchyAddNewElement'&gt;&lt;span title='$services.localization.render('webide.menu.rename.space', [$subspaceNameEscaped])' data-subspace='$subspaceNameEscaped' data-space='$spaceEscaped' class='hierarchyAddNewElementButton hierarchy-rename-folder'&gt;&lt;span class='fa fa-pencil'&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;{{/html}}") ##'"
      #set($renameForm = "{{html clean=false}}&lt;input type='text' id='renameFolder_$spaceEscaped' style='display:none;'/&gt;{{/html}}") ##'"
    #end
    #if("$!removeLinks" != "")
      #set($removeBlock = "$beginRemoveButton$removeLinks$endRemoveButton")
    #end
    $addStars** $beginAddButton$addLinks$endAddButton$!removeBlock$!renameButton$!renameForm (% class="hierarchy-toggleFolder" data-space="$spaceEscapedBackslash" %)((($iconBulletToggle (%%){{html clean='false'}}&lt;span class='fa fa-folder'&gt;&lt;/span&gt;{{/html}} (% id="hierarchyDisplaySpace_$spaceEscaped" class="hierarchySpaceName" %)$subspaceName(%%) )))
    (% id="hierarchySpace_$spaceEscapedBackslash" class="hierarchy-list${contentDisplay}" %)
    #set($pageCount = 0)
  #end
  #if(!$isInClassesList &amp;&amp; !$isGlobal)
    ## Compute page elements
    #if(!$pageDoc.isNew())
      #set($pageEscaped = $escapetool.url($page).replace("+", "%20"))
      #if($nestedSpaces)
        #set($pageEscapedBackslash = $escapetool.url($page).replace("+", "%20"))
      #else
        #set($pageEscapedBackslash = $escapetool.url($page.replace('\', '\\').replace('.', '\.')).replace("+", "%20")) ##"'
      #end
      #set($pageInPagesList = $pagesList.contains($pageFullName))
      #set($pageFullNameEscaped = $escapetool.url($pageFullName).replace("+", "%20"))
      #set($pageRawTitleEscaped = $escapetool.url($pageDoc.title).replace("+", "%20"))
      #set($pageParentEscaped = $escapetool.url($pageDoc.parent).replace("+", "%20"))
      #set($pageClassHidden = " hierarchy-hidden")
      #set($iconBulletToggle = "(% class='hierarchyDisplayPageIcon'%){{html clean='false'}}&lt;span class='fa fa-caret-right'&gt;&lt;/span&gt;{{/html}}")
      #if($visiblePages.contains($pageFullNameEscaped) || $pageFullName == $currentDoc.fullName)
        #set($pageClassHidden = "")
        #set($iconBulletToggle = "(% class='hierarchyDisplayPageIcon'%){{html clean='false'}}&lt;span class='fa fa-caret-down'&gt;&lt;/span&gt;{{/html}}")
      #end
      #set($pageName = "(% id='hierarchyDisplayPage_$pageFullNameEscaped' class='hierarchyPageName'%)$page)))") ##'"
      #if($xwiki.getDocument($pageFullName).hasAccessLevel('edit'))
        #set($pageCount = $pageCount + 1)
        #set($itemPage = "")
        #if($pageDoc.getObject("WebIDECode.ApplicationClass"))
          #set($itemPage = "WebIDECode.ApplicationClass")
        #else
          #foreach($className in $classesInProjectList)
            #if($pageDoc.getObject($className))
              #set($itemPage = $className)
              #break
            #end
          #end
        #end
        #set($renameButton = "")
        #set($renameForm = "")
        #set($removeLinks = "")
        #set($removeBlock = "")
        #if($pageInPagesList &amp;&amp; $masterDoc.hasAccessLevel('edit'))
          #set($removeLinks = "&lt;li&gt;&lt;a href='#' data-pageid='$pageFullNameEscaped' class='hierarchy-remove-page'&gt;$services.localization.render('webide.menu.remove.project')&lt;/a&gt;&lt;/li&gt;") ##'"
        #end
        #if($masterDoc.hasAccessLevel('edit') &amp;&amp; $currentDoc.hasAccessLevel('edit'))
          #if($pageLocaleList.size() == 0)
            #set($removeLinks = "$!removeLinks&lt;li&gt;&lt;a href='#' class='deletePage' data-space='$spaceEscaped' data-page='$pageEscaped' data-locale='default'&gt;$services.localization.render('webide.menu.remove.page')&lt;/a&gt;&lt;/li&gt;") ##'"
          #end
          #set($renameButton = "{{html clean=false}}&lt;div class='btn-group hierarchyAddNewElement'&gt;&lt;span title='$services.localization.render('webide.menu.rename.page', [$pageFullNameEscaped])' data-pageid='$pageFullNameEscaped' class='hierarchyAddNewElementButton hierarchy-rename-page'&gt;&lt;span class='fa fa-pencil'&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;{{/html}}") ##'"
          #set($renameForm = "{{html clean=false}}&lt;input type='text' data-pageinlist='$pageInPagesList' id='renamePage_$pageFullNameEscaped' style='display:none;' value='$pageFullName'/&gt;{{/html}}") ##'"
        #end
        #if("$!removeLinks" != "")
          #set($removeBlock = "$beginRemoveButton$removeLinks$endRemoveButton")
        #end
        #if("$!itemPage" != "") ##It's an "Item" page
          $addStars*** $!removeBlock$!renameButton$!renameForm {{html clean='false'}}&lt;span class='fa fa-hdd-o'&gt;&lt;/span&gt;{{/html}} [[$page&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||data-space='$spaceEscaped' data-page='$pageEscaped' data-object="$itemPage" data-objectnumber="0" data-locale="default" class='editObject']]
        #else ##It's an "Content" page
          #set($objectsTotalSize = $jsxList.size() + $ssxList.size() + $docSheetList.size() + $pageLocaleList.size())
          #set($addLinks = "&lt;li&gt;&lt;a href='#' class='newJSObject newLocalObject' data-space='$spaceEscaped' data-page='$pageEscaped'&gt;$services.localization.render('webide.menu.add.localJS')&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href='#' class='newCSSObject newLocalObject' data-space='$spaceEscaped' data-page='$pageEscaped'&gt;$services.localization.render('webide.menu.add.localCSS')&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href='#' class='newSheet newLocalObject' data-space='$spaceEscaped' data-page='$pageEscaped'&gt;$services.localization.render('webide.menu.add.localSheet')&lt;/a&gt;&lt;/li&gt;") ##'"
          #if($objectsTotalSize == 0)
            $addStars*** $beginAddButton$addLinks$endAddButton$!removeBlock$!renameButton$!renameForm {{html clean='false'}}&lt;span class='fa fa-file'&gt;&lt;/span&gt;{{/html}} [[$page&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||data-locale="default" data-space='$spaceEscaped' data-page='$pageEscaped' data-rawtitle="$pageRawTitleEscaped" data-parent="$pageParentEscaped" data-hidden="$pageDoc.getTranslatedDocument($pageLocale).isHidden()" class='editPage']]
          #else
            $addStars*** $beginAddButton$addLinks$endAddButton$!removeBlock$!renameButton$!renameForm (% data-pageid="$spaceEscapedBackslash.$pageEscapedBackslash" class="hierarchy-displayPage" %)((($iconBulletToggle (%%){{html clean='false'}}&lt;span class='fa fa-file'&gt;&lt;/span&gt;{{/html}} $pageName
          (% id='hierarchyPageDetails_$spaceEscapedBackslash.$pageEscapedBackslash' class='hierarchy-list${pageClassHidden}' %)
            #if($pageLocaleList.size() == 0)
              #set($ok = $pageLocaleList.add('default'))
            #end
            #foreach($pageLocale in $pageLocaleList)
              #set($pageLocaleDisplay = "")
              #if($pageLocale != "default" &amp;&amp; "$!pageLocale" != "")
                #set($pageLocaleDisplay = " ($pageLocale)")
                #set($removeLinks = "")
                #set($removeBlock = "")
                #set($removeLinks = "$!removeLinks&lt;li&gt;&lt;a href='#' class='deletePage' data-space='$spaceEscaped' data-page='$pageEscaped' data-locale='$pageLocale'&gt;$services.localization.render('webide.menu.remove.page')&lt;/a&gt;&lt;/li&gt;") ##'"
                #if("$!removeLinks" != "")
                  #set($removeBlock = "$beginRemoveButton$removeLinks$endRemoveButton")
                #end
              #end
              #if($velocityCount == 1)
                #set($pageLocale = 'default')
              #end
              $addStars**** $!removeBlock {{html clean='false'}}&lt;span class='fa fa-pencil'&gt;&lt;/span&gt;{{/html}} [[$services.localization.render('webide.menu.view.logical.editWiki')$!pageLocaleDisplay&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||data-locale="$pageLocale" data-space='$spaceEscaped' data-page='$pageEscaped' data-rawtitle="$pageRawTitleEscaped" data-parent="$pageParentEscaped" data-hidden="$pageDoc.getTranslatedDocument($pageLocale).isHidden()" class='editPage']]
            #end
            #foreach($jsxObject in $jsxList)
              #if($jsxObject.getProperty('use').value == "onDemand" || $jsxObject.getProperty('use').value == "currentPage" || !$jsxObject.getProperty('use').value)
                #set($removeLinks = "")
                #set($removeBlock = "")
                #set($removeLinks = "$!removeLinks&lt;li&gt;&lt;a href='#' class='deleteObject' data-space='$spaceEscaped' data-page='$pageEscaped' data-object='XWiki.JavaScriptExtension' data-objectnumber='$jsxObject.number'&gt;$services.localization.render('webide.menu.remove.object')&lt;/a&gt;&lt;/li&gt;") ##'"
                #if("$!removeLinks" != "")
                  #set($removeBlock = "$beginRemoveButton$removeLinks$endRemoveButton")
                #end
                $addStars**** $!removeBlock {{html clean='false'}}&lt;span class='fa fa-pencil'&gt;&lt;/span&gt;{{/html}} [[$services.localization.render('webide.menu.view.logical.edit') JS-$jsxObject.number&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||data-space='$spaceEscaped' data-page='$pageEscaped' data-object="XWiki.JavaScriptExtension" data-objectnumber="$jsxObject.number" class='editObject']]
              #end
            #end
            #foreach($ssxObject in $ssxList)
              #set($removeLinks = "")
              #set($removeBlock = "")
              #set($removeLinks = "$!removeLinks&lt;li&gt;&lt;a href='#' class='deleteObject' data-space='$spaceEscaped' data-page='$pageEscaped' data-object='XWiki.StyleSheetExtension' data-objectnumber='$ssxObject.number'&gt;$services.localization.render('webide.menu.remove.object')&lt;/a&gt;&lt;/li&gt;") ##'"
              #if("$!removeLinks" != "")
                #set($removeBlock = "$beginRemoveButton$removeLinks$endRemoveButton")
              #end
              #if($ssxObject.getProperty('use').value == "onDemand" || $ssxObject.getProperty('use').value == "currentPage" || !$ssxObject.getProperty('use').value)
                $addStars**** $!removeBlock {{html clean='false'}}&lt;span class='fa fa-pencil'&gt;&lt;/span&gt;{{/html}} [[$services.localization.render('webide.menu.view.logical.edit') CSS-$ssxObject.number&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||data-space='$spaceEscaped' data-page='$pageEscaped' data-object="XWiki.StyleSheetExtension" data-objectnumber="$ssxObject.number" class='editObject']]
              #end
            #end
            #foreach($docSheetObj in $docSheetList)
              #set($removeLinks = "")
              #set($removeBlock = "")
              #set($removeLinks = "$!removeLinks&lt;li&gt;&lt;a href='#' class='deleteObject' data-space='$spaceEscaped' data-page='$pageEscaped' data-object='XWiki.DocumentSheetBinding' data-objectnumber='$docSheetObj.number'&gt;$services.localization.render('webide.menu.remove.object')&lt;/a&gt;&lt;/li&gt;") ##'"
              #if("$!removeLinks" != "")
                #set($removeBlock = "$beginRemoveButton$removeLinks$endRemoveButton")
              #end
              #set($sheetDoc = $xwiki.getDocument($docSheetObj.sheet))
              $addStars**** $!removeBlock {{html clean='false'}}&lt;span class='fa fa-pencil'&gt;&lt;/span&gt;{{/html}} [[$services.localization.render('webide.menu.view.logical.edit') Sheet-$docSheetObj.number&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||data-space='$spaceEscaped' data-page='$pageEscaped' data-object="XWiki.DocumentSheetBinding" data-objectnumber="$docSheetObj.number" class='editObject']]
            #end
          #end
        #end
      #end
    #end
  #end
#end
#if($pageCount &amp;&amp; $pageCount == 0)
  #if($spaceCount == 0)
    ** $services.localization.render('webide.menu.empty')
  #else
    $addStars*** $services.localization.render('webide.menu.empty')
  #end
#end
## **************************************
## Global objects
## **************************************
#set($globalCategories = {
  'js' : {
    'list' : $allJSList,
    'className' : 'XWiki.JavaScriptExtension',
    'addClass' : 'newJSObject',
    'prettyName' : "$services.localization.render('webide.menu.category.js')",
    'addText' : "$services.localization.render('webide.menu.category.js.add')",
    'check' : {'use' : 'always'},
    'localJS' : 0,
    'rename' : 0,
    'remove' : 'object'
  },
  'css' : {
    'list' : $allCSSList,
    'className' : 'XWiki.StyleSheetExtension',
    'addClass' : 'newCSSObject',
    'prettyName' : "$services.localization.render('webide.menu.category.css')",
    'addText' : "$services.localization.render('webide.menu.category.css.add')",
    'check' : {'use' : 'always'},
    'localJS' : 0,
    'rename' : 0,
    'remove' : 'object'
  },
  'macros' : {
    'list' : $allMacrosList,
    'className' : 'XWiki.WikiMacroClass',
    'addClass' : 'newMacroObject',
    'prettyName' : "$services.localization.render('webide.menu.category.macros')",
    'addText' : "$services.localization.render('webide.menu.category.macros.add')",
    'check' : {},
    'localJS' : 1,
    'rename' : 1,
    'remove' : 'page'
  },
  'panels' : {
    'list' : $allPanelsList,
    'className' : 'Panels.PanelClass',
    'addClass' : 'newPanelObject',
    'prettyName' : "$services.localization.render('webide.menu.category.panels')",
    'addText' : "$services.localization.render('webide.menu.category.panels.add')",
    'check' : {},
    'localJS' : 1,
    'rename' : 1,
    'remove' : 'page'
  },
  'uix' : {
    'list' : $allUIXList,
    'className' : 'XWiki.UIExtensionClass',
    'addClass' : 'newUIXObject',
    'prettyName' : "$services.localization.render('webide.menu.category.uix')",
    'addText' : "$services.localization.render('webide.menu.category.uix.add')",
    'check' : {},
    'localJS' : 0,
    'rename' : 0,
    'remove' : 'object',
    'pageName' : 'UIX'
  }
})
#foreach($category in $globalCategories.keySet())
  #set($pageClassHidden = " hierarchy-hidden")
  #set($iconBulletToggle = "(% class='hierarchyDisplayPageIcon'%){{html clean='false'}}&lt;span class='fa fa-caret-right'&gt;&lt;/span&gt;{{/html}}")
  #if($visibleCategory.contains($category))
    #set($pageClassHidden = "")
    #set($iconBulletToggle = "(% class='hierarchyDisplayPageIcon'%){{html clean='false'}}&lt;span class='fa fa-caret-down'&gt;&lt;/span&gt;{{/html}}")
  #end
  #set($addLinks = "&lt;li&gt;&lt;a href='#' class='$globalCategories[$category].addClass newGlobalObject' data-space='$escapetool.url($codeSpace).replace('+', '%20')' data-page='$!{globalCategories[$category].pageName}' data-toggle='modal' data-target='#hierarchyObjectModal'&gt;$globalCategories[$category].addText&lt;/a&gt;&lt;/li&gt;")
  * $beginAddButton$addLinks$endAddButton (% data-category="$category" class="hierarchy-toggleCategory" %)((($iconBulletToggle  (%%)**$globalCategories[$category].prettyName**)))
  (% id='hierarchyCategory_$category' class='hierarchy-list${pageClassHidden}' %)
  #set($objCount = 0)
  #set($checkPropNameSize = $!globalCategories[$category].get('check').keySet().size())
  #set($checkPropName = '')
  #set($checkProp = "")
  #if($checkPropNameSize &gt; 0)
    #set($checkPropName = $!globalCategories[$category].get('check').keySet().toArray().get(0))
    #set($checkProp = $!globalCategories[$category].get('check').get($checkPropName))
  #end
  #foreach($object in $globalCategories[$category].list)
    #if("$!checkProp" == "" || $object.getProperty($checkPropName).value == $checkProp)
      #set($objCount = $objCount + 1)
      #set($objDoc = $xwiki.getDocument($object.name))
      #set($spaceEscaped = $escapetool.url($objDoc.space).replace("+", "%20"))
      #set($pageEscaped = $escapetool.url($objDoc.name).replace("+", "%20"))
      #set($docName = "$objDoc.name")
      #if("$!object.getProperty('name').value" != "")
        #set($docName = $object.getProperty('name').value)
      #end
      #set($addLinks = "")
      #set($addBlock = "")
      #if($globalCategories[$category].localJS == 1)
        #set($addLinks = "&lt;li&gt;&lt;a href='#' class='newJSObject newLocalObject' data-space='$spaceEscaped' data-page='$pageEscaped'&gt;$services.localization.render('webide.menu.add.localJS')&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href='#' class='newCSSObject newLocalObject' data-space='$spaceEscaped' data-page='$pageEscaped'&gt;$services.localization.render('webide.menu.add.localCSS')&lt;/a&gt;&lt;/li&gt;") ##'"
      #end
      #set($renameButton = "")
      #set($renameForm = "")
      #if($globalCategories[$category].rename == 1)
        #set($pageFullName = $objDoc.fullName)
        #set($pageFullNameEscaped = $escapetool.url($objDoc.fullName).replace("+", "%20"))
        #set($pageInPagesList = $pagesList.contains($pageFullName))
        #set($renameButton = "{{html clean=false}}&lt;div class='btn-group hierarchyAddNewElement'&gt;&lt;span title='$services.localization.render('webide.menu.rename.page', [$pageFullNameEscaped])' data-pageid='$pageFullNameEscaped' class='hierarchyAddNewElementButton hierarchy-rename-page'&gt;&lt;span class='fa fa-pencil'&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;{{/html}}") ##'"
        #set($renameForm = "{{html clean=false}}&lt;input type='text' data-pageinlist='$pageInPagesList' id='renamePage_$pageFullNameEscaped' style='display:none;' value='$pageFullName'/&gt;{{/html}}") ##'"
      #end
      #set($removeLinks = "")
      #set($removeBlock = "")
      #if($globalCategories[$category].remove == 'object')
        #set($removeLinks = "&lt;li&gt;&lt;a href='#' class='deleteObject' data-space='$spaceEscaped' data-page='$pageEscaped' data-object='$globalCategories[$category].className' data-objectnumber='$object.number'&gt;$services.localization.render('webide.menu.remove.object')&lt;/a&gt;&lt;/li&gt;") ##'"
      #elseif($globalCategories[$category].remove == 'page')
        #set($removeLinks = "&lt;li&gt;&lt;a href='#' class='deletePage' data-space='$spaceEscaped' data-page='$pageEscaped' data-locale='default'&gt;$services.localization.render('webide.menu.remove.page')&lt;/a&gt;&lt;/li&gt;") ##'"
      #end
      #if("$!removeLinks" != "")
        #set($removeBlock = "$beginRemoveButton$removeLinks$endRemoveButton")
      #end
      #if("$!addLinks" != "")
        #set($addBlock = "$beginAddButton$addLinks$endAddButton")
      #end
      ** $!addBlock$!removeBlock$!renameButton$!renameForm {{html clean='false'}}&lt;span class='fa fa-hdd-o'&gt;&lt;/span&gt;{{/html}} [[$docName&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||data-space='$spaceEscaped' data-page='$pageEscaped' data-object="$globalCategories[$category].className" data-objectnumber="$object.number" class='editObject']]
      #if($globalCategories[$category].localJS == 1)
        #if($objDoc.getObjects('XWiki.StyleSheetExtension').size() != 0 || $objDoc.getObjects('XWiki.JavaScriptExtension').size() != 0)
          (% class='hierarchy-list' %)
        #end
        #foreach($jsxObject in $objDoc.getObjects('XWiki.JavaScriptExtension'))
          #set($removeLinks = "")
          #set($removeBlock = "")
          #set($removeLinks = "$!removeLinks&lt;li&gt;&lt;a href='#' class='deleteObject' data-space='$spaceEscaped' data-page='$pageEscaped' data-object='XWiki.JavaScriptExtension' data-objectnumber='$jsxObject.number'&gt;$services.localization.render('webide.menu.remove.object')&lt;/a&gt;&lt;/li&gt;") ##'"
          #if("$!removeLinks" != "")
            #set($removeBlock = "$beginRemoveButton$removeLinks$endRemoveButton")
          #end
          *** {{html clean='false'}}&lt;span class='fa fa-pencil'&gt;&lt;/span&gt;{{/html}} $!removeBlock [[$services.localization.render('webide.menu.view.logical.edit') JS-$jsxObject.number&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||data-space='$spaceEscaped' data-page='$pageEscaped' data-object="XWiki.JavaScriptExtension" data-objectnumber="$jsxObject.number" class='editObject']]
        #end
        #foreach($ssxObject in $objDoc.getObjects('XWiki.StyleSheetExtension'))
          #set($removeLinks = "")
          #set($removeBlock = "")
          #set($removeLinks = "$!removeLinks&lt;li&gt;&lt;a href='#' class='deleteObject' data-space='$spaceEscaped' data-page='$pageEscaped' data-object='XWiki.StyleSheetExtension' data-objectnumber='$ssxObject.number'&gt;$services.localization.render('webide.menu.remove.object')&lt;/a&gt;&lt;/li&gt;") ##'"
          #if("$!removeLinks" != "")
            #set($removeBlock = "$beginRemoveButton$removeLinks$endRemoveButton")
          #end
          *** {{html clean='false'}}&lt;span class='fa fa-pencil'&gt;&lt;/span&gt;{{/html}} $!removeBlock [[$services.localization.render('webide.menu.view.logical.edit') CSS-$ssxObject.number&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||data-space='$spaceEscaped' data-page='$pageEscaped' data-object="XWiki.StyleSheetExtension" data-objectnumber="$ssxObject.number" class='editObject']]
        #end
      #end
    #end
  #end
  #if($objCount == 0)
   ** $services.localization.render('webide.menu.empty')
  #end
#end
## Translations
#set($pageClassHidden = " hierarchy-hidden")
#set($iconBulletToggle = "(% class='hierarchyDisplayPageIcon'%){{html clean='false'}}&lt;span class='fa fa-caret-right'&gt;&lt;/span&gt;{{/html}}")
#if($visibleCategory.contains("translations"))
  #set($pageClassHidden = "")
  #set($iconBulletToggle = "(% class='hierarchyDisplayPageIcon'%){{html clean='false'}}&lt;span class='fa fa-caret-down'&gt;&lt;/span&gt;{{/html}}")
#end
#set($addLinks = "&lt;li&gt;&lt;a href='#' class='newTranslationObject newGlobalObject' data-space='$escapetool.url($codeSpace).replace('+', '%20')' data-page='Translations' data-toggle='modal' data-target='#hierarchyObjectModal'&gt;$services.localization.render('webide.menu.category.translations.add')&lt;/a&gt;&lt;/li&gt;")
* $beginAddButton$addLinks$endAddButton (% data-category="translations" class="hierarchy-toggleCategory" %)((($iconBulletToggle  (%%)**$services.localization.render('webide.menu.category.translations')**)))
(% id='hierarchyCategory_translations' class='hierarchy-list${pageClassHidden}' %)
#foreach($translationObj in $allTranslationsList)
  #set($objDoc = $xwiki.getDocument($translationObj.name))
  #set($docName = $objDoc.name)
  #set($spaceEscaped = $escapetool.url($objDoc.space).replace("+", "%20"))
  #set($pageEscaped = $escapetool.url($objDoc.name).replace("+", "%20"))
  #if($nestedSpaces)
    #set($pageFullName = "${objDoc.space}.${docName.replace('\', '\\').replace('.', '\.')}") ##'"
    #set($spaceEscapedBackslash = $escapetool.url($objDoc.space).replace("+", "%20"))
    #set($pageEscapedBackslash = $escapetool.url($docName).replace("+", "%20"))
  #else
    #set($pageFullName = "${objDoc.space.replace('\', '\\').replace('.', '\.')}.${docName.replace('\', '\\').replace('.', '\.')}") ##'"
    #set($spaceEscapedBackslash = $escapetool.url($objDoc.space.replace('\', '\\').replace('.', '\.')).replace("+", "%20")) ##'
    #set($pageEscapedBackslash = $escapetool.url($docName.replace('\', '\\').replace('.', '\.')).replace("+", "%20")) ##'
  #end
  #set($pageFullNameEscaped = $escapetool.url($pageFullName).replace("+", "%20"))
  #set($titleEscaped = $escapetool.url($objDoc.title).replace("+", "%20"))
  #set($pageParentEscaped = $escapetool.url($objDoc.parent).replace("+", "%20"))
  #set($pageInPagesList = $pagesList.contains($pageFullName))
  #set($pageClassHidden = " hierarchy-hidden")
  #set($iconBulletToggle = "(% class='hierarchyDisplayPageIcon'%){{html clean='false'}}&lt;span class='fa fa-caret-right'&gt;&lt;/span&gt;{{/html}}")
  #if($visiblePages.contains("Tr-$pageFullNameEscaped") || $pageFullName == $currentDoc.fullName)
    #set($pageClassHidden = "")
    #set($iconBulletToggle = "(% class='hierarchyDisplayPageIcon'%){{html clean='false'}}&lt;span class='fa fa-caret-down'&gt;&lt;/span&gt;{{/html}}")
  #end
  #set($pageLocaleList = $objDoc.getTranslationList())
  #set($pageLocaleList = $sorttool.sort($pageLocaleList))
  #set($ok = $pageLocaleList.add(0, $objDoc.defaultLanguage))
  #set($addLinks = "&lt;li&gt;&lt;a href='#' class='newPage newLanguage' data-space='$spaceEscaped' data-page='$pageEscaped' data-toggle='modal' data-target='#hierarchyPageModal'&gt;$services.localization.render('webide.menu.category.translations.addLanguage')&lt;/a&gt;&lt;/li&gt;") ##'"
  #set($renameButton = "")
  #set($renameForm = "")
  #if($objDoc.hasAccessLevel('edit'))
    #set($renameButton = "{{html clean=false}}&lt;div class='btn-group hierarchyAddNewElement'&gt;&lt;span title='$services.localization.render('webide.menu.rename.page', [$pageFullNameEscaped])' data-pageid='$pageFullNameEscaped' class='hierarchyAddNewElementButton hierarchy-rename-page'&gt;&lt;span class='fa fa-pencil'&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;{{/html}}") ##'"
    #set($renameForm = "{{html clean=false}}&lt;input type='text' data-pageinlist='$pageInPagesList' id='renamePage_$pageFullNameEscaped' style='display:none;' value='$pageFullName'/&gt;{{/html}}") ##'"
  #end
  ** $beginAddButton$addLinks$endAddButton$!renameButton$!renameForm (% data-pageid="Tr-$spaceEscapedBackslash.$pageEscapedBackslash" class="hierarchy-displayPage" %)((($iconBulletToggle  (%%){{html clean='false'}}&lt;span class='fa fa-file'&gt;&lt;/span&gt;{{/html}} (%%)$docName )))
  (% id='hierarchyPageDetails_Tr-$spaceEscapedBackslash.$pageEscapedBackslash' class='hierarchy-list${pageClassHidden}' %)
  #foreach($pageLocale in $pageLocaleList)
    #if($pageLocale == "")
      #set($pageLocale = "default")
      #set($displayLanguage = "Default")
    #else
      #set($language = $services.localization.toLocale($pageLocale).getDisplayLanguage())
      #set($displayLanguage = $language)
      #if($language.length() &gt; 0)
        #set($displayLanguage = "${language.substring(0, 1).toUpperCase()}${language.substring(1)}")
      #end
    #end
  #set($removeLinks = "")
  #set($removeBlock = "")
  #if($pageLocaleList.size() == 1 || $pageLocale != 'default')
    #set($removeLinks = "$!removeLinks&lt;li&gt;&lt;a href='#' class='deletePage' data-space='$spaceEscaped' data-page='$pageEscaped' data-locale='$pageLocale'&gt;$services.localization.render('webide.menu.remove.page')&lt;/a&gt;&lt;/li&gt;") ##'"
    #if("$!removeLinks" != "")
      #set($removeBlock = "$beginRemoveButton$removeLinks$endRemoveButton")
    #end
  #end
    *** {{html clean='false'}}&lt;span class='fa fa-pencil'&gt;&lt;/span&gt;{{/html}}$!removeBlock [[$displayLanguage&gt;&gt;path:$masterDoc.getURL('view', '#!XWebIDE')||data-locale="$pageLocale" data-space='$spaceEscaped' data-page='$pageEscaped' data-rawtitle="$titleEscaped" data-parent="$pageParentEscaped" data-hidden="$objDoc.getTranslatedDocument($pageLocale).isHidden()" class='editPage']]
  #end
#end
#if($allTranslationsList.size() == 0)
 ** //Empty//
#end
{{html clean=false}}
&lt;div id="hierarchyUpdatedClassList" class="hierarchy-hidden"&gt;#foreach($class in $classesInProjectList)
  #set($classDoc = $xwiki.getDocument($class))
    &lt;option value="$escapetool.url($class).replace('+', '%20')"&gt;$classDoc.name&lt;/option&gt;
#end&lt;/div&gt;
{{/html}}
{{/velocity}}</content>
</xwikidoc>
